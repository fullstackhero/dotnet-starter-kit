# ===================================================================
# üë§ BASE USER ENDPOINTS - Standard User Operations
# ===================================================================
# Required: Valid JWT token with 'base_user' role or higher
# Scope: Profile management, password changes, verification

@Server_HostAddress = https://localhost:7000
@API_Version = v1
@Base_Auth_URL = {{Server_HostAddress}}/api/{{API_Version}}/auth

# ===================================================================
# üé´ TOKEN MANAGEMENT
# ===================================================================
# Get token from public.http login responses

# Option 1: From public.http user login
@base_user_token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJlN2EzOGQ4OC02NGUwLTQ1ZTYtODZkMi03MWU0ZmE1YTIxMTgiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6ImU3YTM4ZDg4LTY0ZTAtNDVlNi04NmQyLTcxZTRmYTVhMjExOCIsImVtYWlsIjpbInVzZXJAZXhhbXBsZS5jb20iLCJ1c2VyQGV4YW1wbGUuY29tIl0sInVzZXJuYW1lIjoidXBkYXRlZF91c2VybmFtZSIsImZpcnN0X25hbWUiOiJNdWhhbW1lZCBGdXJrYW4iLCJsYXN0X25hbWUiOiJIYXlkYXJpIiwicGhvbmVfbnVtYmVyIjoiNTQ0NzYyNzg1OCIsInByb2Zlc3Npb24iOiJTZW5pb3IgU29mdHdhcmUgRW5naW5lZXIiLCJzdGF0dXMiOiJBQ1RJVkUiLCJpYXQiOjE3NDk1NDYzOTMsImp0aSI6ImMyZWJiNDNjLThmOGQtNDUzNy04OTkwLTc4ZDQzN2MyZjgzNiIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6ImJhc2VfdXNlciIsInJvbGUiOiJiYXNlX3VzZXIiLCJleHAiOjE3NTAxNTExOTMsImlzcyI6Imh0dHBzOi8vZnVsbHN0YWNraGVyby5uZXQiLCJhdWQiOiJmdWxsc3RhY2toZXJvIn0.ajZQLRWDzR4oVqV1d-656pks8gEUH5WpuBHZQATffhQ

# Option 2: Environment variable (CI/CD)
# @base_user_token = {{$dotenv BASE_USER_TOKEN}}

# Option 3: Manual token (for quick testing)
# @base_user_token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJlN2EzOGQ4OC02NGUwLTQ1ZTYtODZkMi03MWU0ZmE1YTIxMTgiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6ImU3YTM4ZDg4LTY0ZTAtNDVlNi04NmQyLTcxZTRmYTVhMjExOCIsImVtYWlsIjpbInVzZXJAZXhhbXBsZS5jb20iLCJ1c2VyQGV4YW1wbGUuY29tIl0sInVzZXJuYW1lIjoic3RhbmRhcmR1c2VyIiwiZmlyc3RfbmFtZSI6Ik11aGFtbWVkIEZ1cmthbiIsImxhc3RfbmFtZSI6IkhheWRhcmkiLCJwaG9uZV9udW1iZXIiOiI1NDQ3NjI3ODU4IiwicHJvZmVzc2lvbiI6IlNvZnR3YXJlIEVuZ2luZWVyIiwic3RhdHVzIjoiQUNUSVZFIiwiaWF0IjoxNzQ5NTQ1OTA5LCJqdGkiOiIxYWRmODNjNS0xOGU5LTQ5NjUtODQzNy1hMDNjMTc2MDg2YmYiLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3JvbGUiOiJiYXNlX3VzZXIiLCJyb2xlIjoiYmFzZV91c2VyIiwiZXhwIjoxNzUwMTUwNzA5LCJpc3MiOiJodHRwczovL2Z1bGxzdGFja2hlcm8ubmV0IiwiYXVkIjoiZnVsbHN0YWNraGVybyJ9.Y1XBAQYCslbLO0Bnc1njZe5-qwJlbmTY8_aDbEeiQLs

# For testing different role endpoints
@customer_admin_token = {{customerAdminLogin.response.body.accessToken}}

# ===================================================================
# üë§ PROFILE MANAGEMENT
# ===================================================================

### Get Current User Profile
GET {{Base_Auth_URL}}/profile
Authorization: Bearer {{base_user_token}}

### Update Profile (Limited Fields)
# Base users can only update: username, profession
PUT {{Base_Auth_URL}}/profile
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "username": "updated_username",
  "profession": "Senior Software Engineer"
}

# ===================================================================
# üìßüì± SECURE CONTACT UPDATES
# ===================================================================

### Update Email (Resets verification status)
PUT {{Base_Auth_URL}}/profile/email
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "newEmail": "2newemail@example.com"
}

### Verify Email Update (Complete email change with verification code)
POST {{Base_Auth_URL}}/profile/verify-email
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "newEmail": "2newemail@example.com",
  "verificationCode": "Y7dHMl1Fh/AT5njr6zaStXuSM2bnGr9GTXcmDLSlq6E="
}

### Update Phone Number (Resets verification status)
PUT {{Base_Auth_URL}}/profile/phone
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "newPhoneNumber": "5553624567"
}

### Verify Phone Update (Complete phone change with SMS code)
POST {{Base_Auth_URL}}/profile/verify-phone
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "newPhoneNumber": "5553624567",
  "verificationCode": "156465"
}

# ===================================================================
# üîê PASSWORD MANAGEMENT
# ===================================================================

### Change Password
POST {{Base_Auth_URL}}/change-password
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "currentPassword": "User123!",
  "newPassword": "NewPassword123!"
}

# ===================================================================
# ‚úÖ VERIFICATION PROCESSES
# ===================================================================

### Verify Email Address
POST {{Base_Auth_URL}}/verify-email
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "verificationCode": "123456"
}

### Verify Phone Number
POST {{Base_Auth_URL}}/verify-phone
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "verificationCode": "123456"
}

### Request Email Verification Code
POST {{Base_Auth_URL}}/request-email-verification
Authorization: Bearer {{base_user_token}}

### Request Phone Verification Code
POST {{Base_Auth_URL}}/request-phone-verification
Authorization: Bearer {{base_user_token}}

# ===================================================================
# üîç USER INFORMATION & PERMISSIONS
# ===================================================================

### Get User Permissions/Roles
GET {{Base_Auth_URL}}/permissions
Authorization: Bearer {{base_user_token}}

### Get Available System Roles
GET {{Base_Auth_URL}}/roles
Authorization: Bearer {{base_user_token}}

### Get Current User Claims
GET {{Base_Auth_URL}}/claims
Authorization: Bearer {{base_user_token}}

# ===================================================================
# üß™ TESTING SCENARIOS
# ===================================================================

### Test Invalid Username Update
PUT {{Base_Auth_URL}}/profile
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "username": "a",
  "profession": "Test"
}

### Test Restricted Field Update (Should Fail)
PUT {{Base_Auth_URL}}/profile
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "firstName": "Should Not Work",
  "lastName": "Restricted Field"
}

### Test Invalid Email Format
PUT {{Base_Auth_URL}}/profile/email
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "newEmail": "invalid-email-format"
}

### Test Invalid Phone Format
PUT {{Base_Auth_URL}}/profile/phone
Authorization: Bearer {{base_user_token}}
Content-Type: application/json

{
  "newPhoneNumber": "invalid-phone"
}

# ===================================================================
# üìã USAGE NOTES
# ===================================================================
#
# BASE USER CAPABILITIES:
# ‚úÖ View own profile
# ‚úÖ Update username (with validation)
# ‚úÖ Update profession
# ‚úÖ Change password (with current password verification)
# ‚úÖ Update email (separate endpoint, resets verification)
# ‚úÖ Update phone (separate endpoint, resets verification)
# ‚úÖ Verify email/phone with codes
# ‚úÖ View own permissions and roles
#
# BASE USER RESTRICTIONS:
# ‚ùå Cannot update firstName/lastName (immutable after registration)
# ‚ùå Cannot view other users' data
# ‚ùå Cannot assign roles
# ‚ùå Cannot delete accounts
# ‚ùå Cannot access admin endpoints
#
# SECURITY FEATURES:
# - Username validation (3-20 chars, alphanumeric + underscore)
# - Email/phone updates reset verification status
# - Password strength validation (8+ chars, mixed case, digits, special)
# - All endpoints require valid JWT token
# - Role-based access control
#
# TOKEN SETUP:
# 1. Run public.http ‚Üí "Standard User Login"
# 2. Token automatically available as {{userLogin.response.body.accessToken}}
# 3. Or set BASE_USER_TOKEN environment variable
#
# ERROR HANDLING:
# - 401: Invalid or expired token
# - 403: Insufficient permissions
# - 400: Validation errors
# - 422: Business rule violations 